# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## AI Assistant Guidelines

Always use Context7 MCP when needing library/API documentation, code generation, setup or configuration steps without requiring explicit requests.

## Project Structure

This is a Next.js 14 real estate dashboard application with full-stack authentication and database integration. The main application is located in the `v0-LeadNudge-VAPI/` directory.

The `lead-nudge-crm-relay/` directory contains files necessary to create an integration between Botpress and the main application located in the `v0-LeadNudge-VAPI/` directory.

`lead-nudge-crm-relay/integrations.definition.ts`: Contains the integration definition. It exports a data structure that describes the integrationâ€”what it is, what it can do, and how it can be used. This includes the integration's name, version, actions, events, channels, and other capabilities.

`lead-nudge-crm-relay/src/index.ts`: Contains the integration implementation. It exports a data structure that implements what was defined in the integration definition. Keep reading this documentation to learn about the available callbacks you can implement.

`lead-nudge-crm-relay`: Contains the integration output, generated by the build command. It includes types to help you implement your integration, and bundled JavaScript used to execute it. You can explore its contents, but avoid importing from nested files or folders, as its structure may change. Everything meant to be imported is available from the root of this folder.

### Key Architecture Components

- **Next.js App Router**: Uses the new app directory structure with TypeScript
- **Supabase Integration**: Full-stack authentication and database with multiple client configurations
- **Authentication Flow**: Custom middleware-based auth with OAuth callback handling
- **UI Components**: shadcn/ui components with Radix UI primitives and Tailwind CSS
- **Email Integration**: React Email templates with Resend service
- **Botpress Integration**: Contains files and components which implement and define an integration between our application and Botpress

### Directory Structure

- `app/` - Next.js app router pages and layouts
  - `auth/` - Authentication pages and callback handlers
  - `dashboard/` - Main dashboard interface
  - `contacts/` - Contact management
  - `calendar/` - Calendar functionality
  - `messages/` - Messaging system
  - `api/` - API routes
- `components/` - Reusable React components organized by feature
  - `ui/` - shadcn/ui base components
  - `auth/` - Authentication-specific components
  - `dashboard/`, `contacts/`, `calendar/` - Feature-specific components
- `lib/` - Utility functions and configurations
  - `supabase/` - Multiple Supabase client configurations (client, server, middleware)
  - `auth.ts` - Authentication utilities
  - `database.types.ts` - TypeScript types for database schema
- `middleware.ts` - Next.js middleware for authentication and routing

### Authentication Architecture

The app uses a sophisticated authentication system with:
- **Multiple Supabase Clients**: Separate clients for browser, server, and middleware contexts
- **Session Management**: Automatic session refresh in middleware
- **Protected Routes**: Middleware-based route protection with public route exceptions
- **OAuth Callback Handling**: Custom OAuth redirect handling at root path

## Development Commands

Navigate to the `v0-LeadNudge-VAPI/` directory before running commands:

```bash
cd v0-LeadNudge-VAPI
```

### Core Commands
- `npm dev` - Start development server
- `npm build` - Build for production
- `npm start` - Start production server
- `npm lint` - Run ESLint (configured to ignore during builds)

### Package Management
- Uses `npm` as the package manager
- Lock files: `package-lock.json` and `yarn.lock` (both present)

## Configuration Notes

### Build Configuration
- ESLint and TypeScript errors are ignored during builds (see `next.config.mjs`)
- Images are unoptimized for deployment flexibility

### Environment Variables
- Requires Supabase configuration in `.env` file
- Fallback values are hardcoded in client configuration (production setup)

### Tailwind Configuration
- Uses CSS variables for theme colors
- Includes safelist patterns for dynamic primary color classes
- shadcn/ui component system with custom theme overrides

## Key Files to Understand

- `middleware.ts` - Critical for understanding authentication flow and route protection
- `lib/supabase/` - Multiple client configurations for different contexts
- `app/layout.tsx` - Root layout with auth provider and client-side layout wrapper
- `components/auth/supabase-auth-provider.tsx` - Auth context provider
- `tailwind.config.ts` - Theme configuration with CSS variable system

## Working with Authentication

When modifying auth-related code:
1. Understand the different Supabase client contexts (browser/server/middleware)
2. Be aware of the custom OAuth callback handling in middleware
3. Check route protection logic in middleware for public vs protected routes
4. Consider session refresh behavior and cookie management

## Styling System

- Uses Tailwind CSS with CSS variables for theming
- shadcn/ui components provide consistent UI patterns
- Theme switching capabilities built-in
- Custom CSS overrides in `styles/theme-override.css`

# important-instruction-reminders
Do what has been asked; nothing more, nothing less.
NEVER create files unless they're absolutely necessary for achieving your goal.
ALWAYS prefer editing an existing file to creating a new one.
NEVER proactively create documentation files (*.md) or README files. Only create documentation files if explicitly requested by the User.